<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>CRM Vendedor</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#111827">
  <style>
    :root{--bg:#0f172a;--card:#111827;--muted:#94a3b8;--fg:#e5e7eb;--acc:#22c55e;--line:#1f2937}
    *{box-sizing:border-box} body{margin:0;background:#0f172a;color:#e5e7eb;font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
    header{position:sticky;top:0;background:#111827;padding:12px 16px;display:flex;gap:12px;align-items:center;border-bottom:1px solid var(--line);z-index:5}
    header h1{font-size:16px;margin:0}
    button,select,input,textarea{background:#0b1220;color:#e5e7eb;border:1px solid var(--line);border-radius:10px;padding:10px}
    button.primary{background:#22c55e;color:#0b1220;border:none}
    .container{padding:16px;max-width:1000px;margin:0 auto}
    .grid{display:grid;gap:12px}
    .card{background:#111827;border:1px solid var(--line);border-radius:16px;padding:16px}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .muted{color:#94a3b8}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tabs button{padding:8px 12px;border-radius:999px;border:1px solid var(--line);background:#0b1220}
    .tabs button.active{background:#22c55e;color:#0b1220;border-color:#22c55e}
    .list{display:grid;gap:8px}
    .item{background:#0b1220;border:1px solid var(--line);border-radius:12px;padding:12px}
    .badge{background:#1f2937;padding:2px 8px;border-radius:999px;font-size:12px}
    .danger{background:#ef4444;color:white}
    .two-col{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:800px){ .two-col{grid-template-columns:1fr} }
    label{font-size:12px;color:#94a3b8}
    .field{display:grid;gap:6px}
    .upper{text-transform:uppercase}
    .lower{text-transform:lowercase}
    .hidden{display:none}
    .section-title{font-weight:600;margin-top:8px}
    .toggle-group{display:flex;gap:8px;flex-wrap:wrap}
    .toggle{display:flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#0b1220;cursor:pointer}
    .toggle input{width:16px;height:16px}
    .toggle.active{background:#22c55e;color:#0b1220;border-color:#22c55e}
    .cal{display:grid;gap:12px}
    .cal-head{display:flex;align-items:center;justify-content:space-between}
    .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .cal-cell{background:#0b1220;border:1px solid var(--line);border-radius:10px;min-height:80px;padding:8px;position:relative}
    .cal-day{font-size:12px;color:#94a3b8}
    .cal-dot{position:absolute;width:6px;height:6px;border-radius:999px;background:#22c55e;bottom:8px;right:8px}
    .cal-dot.cancel{background:#ef4444}
    .cal-dot.done{background:#60a5fa}
    .cal-cell.today{outline:2px solid #22c55e}
    .cal-weekdays{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .cal-weekdays div{font-size:12px;color:#94a3b8;text-align:center}
  </style>
</head>
<body>
  <header>
    <h1>CRM Vendedor</h1>
    <div class="row" style="margin-left:auto">
      <button id="btnExport" title="Exportar JSON">Exportar</button>
      <button id="btnLogout">Salir</button>
    </div>
  </header>
  <div class="container">
    <div id="viewLogin" class="card">
      <h2>Acceso</h2>
      <p class="muted">Protege la app con una contraseña local.</p>
      <div class="grid" style="max-width:400px">
        <input id="inEmail" class="lower" placeholder="Email de administrador" type="email" autocapitalize="none" spellcheck="false">
        <input id="inPass" placeholder="Contraseña" type="password">
        <button id="btnLogin" class="primary">Entrar</button>
      </div>
    </div>

    <div id="viewApp" style="display:none">
      <div class="tabs" style="margin-bottom:12px">
        <button data-tab="clientes" class="active">Clientes</button>
        <button data-tab="visitas">Visitas</button>
        <button data-tab="agenda">Agenda</button>
        <button data-tab="ajustes">Ajustes</button>
      </div>

      <section id="tab-clientes">
        <div class="card">
          <div class="row">
            <input id="buscarCliente" placeholder="Buscar cliente…">
            <button id="btnNuevoCliente" class="primary">Nuevo cliente</button>
          </div>
        </div>
        <div id="listaClientes" class="list"></div>
      </section>

      <section id="tab-visitas" style="display:none">
        <div class="card">
          <div class="row">
            <button id="btnNuevaVisita" class="primary">Nueva visita</button>
          </div>
        </div>
        <div id="listaVisitas" class="list"></div>
      </section>

      <section id="tab-agenda" style="display:none">
        <div class="card cal">
          <div class="cal-head">
            <button id="calPrev">◀</button>
            <div id="calTitle" class="muted">Mes Año</div>
            <button id="calNext">▶</button>
          </div>
          <div class="cal-weekdays">
            <div>L</div><div>M</div><div>X</div><div>J</div><div>V</div><div>S</div><div>D</div>
          </div>
          <div id="calGrid" class="cal-grid"></div>
        </div>
        <div class="card">
          <div class="row">
            <input id="fDesde" type="date">
            <input id="fHasta" type="date">
            <button id="btnFiltrarAgenda">Filtrar</button>
          </div>
        </div>
        <div id="listaAgenda" class="list"></div>
      </section>

      <section id="tab-ajustes" style="display:none">
        <div class="card grid">
          <h3>Seguridad</h3>
          <input id="nuevoPIN" placeholder="Nueva contraseña" type="password">
          <button id="btnGuardarPIN">Guardar</button>
        </div>
      </section>
    </div>

    <!-- Cliente Form -->
    <section id="viewClienteForm" style="display:none">
      <div class="card grid">
        <div class="row" style="justify-content:space-between">
          <h2 id="clienteFormTitulo">Nuevo cliente</h2>
          <div class="row">
            <button id="btnVisitaHoy" title="Registrar visita de hoy">Visita hoy</button>
            <button id="btnCancelarCliente">Cancelar</button>
            <button id="btnGuardarCliente" class="primary">Guardar</button>
          </div>
        </div>
      </div>
      <div class="card grid">
        <div class="two-col">
          <div class="field"><label>Nombre de la empresa</label><input id="cNombreEmpresa" class="upper" placeholder="Ej.: GRUPO X S.L."></div>
          <div class="field"><label>Nombre comercial</label><input id="cNombreComercial" class="upper" placeholder="Ej.: RESTAURANTE X"></div>
          <div class="field"><label>CIF / NIF / NIE</label><input id="cNIF" class="upper" placeholder="Ej.: B12345678"></div>
          <div class="field"><label>Tipo de establecimiento</label>
            <select id="cTipo">
              <option>Restaurante</option><option>Bar/Cafetería</option><option>Hotel</option>
              <option>Chiringuito de playa</option><option>Campo de golf</option><option>Club deportivo</option><option>Otros</option>
            </select>
          </div>
          <div class="field"><label>Dirección</label><input id="cDireccion" class="upper" placeholder="CALLE, Nº, PISO…"></div>
          <div class="field"><label>Teléfono</label><input id="cTelefono" type="tel" inputmode="tel" placeholder="+34 600 000 000"></div>
          <div class="field"><label>Persona de contacto</label><input id="cContacto" class="upper" placeholder="NOMBRE Y CARGO"></div>
          <div class="field"><label>Email</label><input id="cEmail" class="lower" type="email" autocapitalize="none" spellcheck="false" placeholder="correo@dominio.com"></div>
        </div>

        <div class="two-col">
          <div class="field"><label>Geolocalización (latitud)</label><input id="cLat" placeholder="Ej.: 39.57"></div>
          <div class="field"><label>Geolocalización (longitud)</label><input id="cLng" placeholder="-2.65"></div>
        </div>
        <div class="row"><button id="btnGeo">Usar mi ubicación</button></div>

        <div class="field">
          <label>Forma de pago</label>
          <select id="cFormaPago">
            <option value="">— Selecciona —</option>
            <option value="CONTADO">Contado</option>
            <option value="GIRO">Giro</option>
            <option value="TRANSFERENCIA">Transferencia</option>
          </select>
        </div>

        <div id="pagoContado" class="grid hidden">
          <div class="section-title">Contado</div>
          <div class="field">
            <label>Método</label>
            <select id="cContadoMetodo">
              <option value="EFECTIVO">Efectivo</option>
              <option value="TALON">Talón</option>
              <option value="TARJETA">Tarjeta</option>
            </select>
          </div>
        </div>

        <div id="pagoGiro" class="grid hidden">
          <div class="section-title">Giro</div>
          <div class="row"><label><input type="checkbox" id="cGiroContado"> A contado</label></div>
          <div class="field"><label>Días (si no es a contado)</label><input id="cGiroDias" type="number" min="0" placeholder="Ej.: 30"></div>
        </div>

        <div id="pagoTransferencia" class="grid hidden">
          <div class="section-title">Transferencia</div>
          <div class="two-col">
            <div class="field"><label>Días</label><input id="cTransfDias" type="number" min="0" placeholder="Ej.: 30"></div>
            <div class="field"><label>Día de la transferencia (1–31)</label><input id="cTransfDiaMes" type="number" min="1" max="31" placeholder="Ej.: 15"></div>
          </div>
        </div>

        <div class="field"><label>Notas</label><textarea id="cNotas" class="upper" rows="5" placeholder="OBSERVACIONES RELEVANTES…"></textarea></div>
      </div>
    </section>

    <!-- Visita Form (nuevo/editar) -->
    <section id="viewVisitaForm" style="display:none">
      <div class="card grid">
        <div class="row" style="justify-content:space-between">
          <h2 id="visitaTitulo">Registrar / Editar visita</h2>
          <div class="row">
            <button id="btnCancelarVisita">Cancelar</button>
            <button id="btnGuardarVisita" class="primary">Guardar visita</button>
          </div>
        </div>
      </div>

      <div class="card grid">
        <div class="two-col">
          <div class="field">
            <label>Fecha y hora</label>
            <input id="vFechaHora" type="datetime-local">
          </div>
          <div class="field">
            <label>Estado</label>
            <div class="toggle-group" id="estadoGroup">
              <label class="toggle" data-estado="Planeada"><input type="checkbox" id="chkPlaneada"> Planeada</label>
              <label class="toggle" data-estado="Realizada"><input type="checkbox" id="chkRealizada"> Realizada</label>
              <label class="toggle" data-estado="Cancelada"><input type="checkbox" id="chkCancelada"> Cancelada</label>
            </div>
          </div>
        </div>

        <div id="panelAgendar" class="card hidden">
          <div class="section-title">Agendar visita</div>
          <div class="field">
            <label>Fecha y hora de la visita</label>
            <input id="vAgendaFechaHora" type="datetime-local">
          </div>
          <p class="muted">Las visitas “Planeadas” aparecerán en la Agenda.</p>
        </div>

        <div class="field"><label>Notas</label><textarea id="vNotas" rows="4" placeholder="Resumen de la visita…"></textarea></div>
      </div>

      <div class="card grid">
        <h3>Productos ofrecidos</h3>
        <div id="vProductos" class="grid"></div>
      </div>
    </section>

  </div>
  <script src="app.js?v=8.1" defer></script>
</body>
</html>
